<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.siat.post.domain.board.BoardMapper">
  <sql id="boardIdxByboardSlug">
    SELECT board_idx 
    FROM BOARD_TBL
    <where>
      board_slug = #{boardSlug}   
    </where>
  </sql>

  <select id="selectBoardIdxByboardSlug">
    <include refid="boardIdxByboardSlug"></include>
  </select>

  <select id="existsByBoardSlug" resultType="boolean" parameterType="String">
    SELECT EXISTS (
      SELECT 1
      FROM BOARD_TBL
      WHERE board_slug = #{boardSlug}
    ) AS exist
  </select>

  <select id="selectBoards" resultType="com.siat.post.domain.board.dto.BoardResponseDto">
    SELECT 
      board_idx,
      board_name,
      board_description,
      board_slug,
      reg_date,
      update_date,
      is_delete
    FROM BOARD_TBL
    WHERE is_delete = 0
  </select>

  <select id="selectBoardByIdx" parameterType="Integer" resultType="com.siat.post.domain.board.dto.BoardResponseDto">
    SELECT 
      board_idx,
      board_name,
      board_description,
      board_slug,
      reg_date,
      update_date,
      is_delete
    FROM BOARD_TBL
    WHERE board_idx = #{boardIdx}
  </select>

  <select id="selectBoardBySlug" parameterType="String" resultType="com.siat.post.domain.board.dto.BoardResponseDto">
    SELECT 
      board_idx,
      board_name,
      board_description,
      board_slug,
      reg_date,
      update_date,
      is_delete
    FROM BOARD_TBL
    WHERE board_slug = #{boardSlug}
  </select>

  <insert id="insertBoard" parameterType="com.siat.post.domain.board.dto.Board" useGeneratedKeys="true" keyProperty="boardIdx" keyColumn="board_idx">
    INSERT INTO BOARD_TBL (
      board_name,
      board_description,
      board_slug,
      is_delete
    ) VALUES (
      #{boardName},
      #{boardDescription},
      #{boardSlug},
      0
    )
  </insert>

  <update id="updateBoardByIdx" parameterType="com.siat.post.domain.board.dto.BoardUpdateRequestDto">
    UPDATE BOARD_TBL
    <set>
      <if test="boardName != null">board_name = #{boardName},</if>
      <if test="boardDescription != null">board_description = #{boardDescription},</if>
      <if test="boardSlug != null">board_slug = #{boardSlug},</if>
      update_date = now()
    </set>
    WHERE board_idx = #{boardIdx} AND is_delete = 0
  </update>

  <update id="updateBoardBySlug" parameterType="com.siat.post.domain.board.dto.BoardUpdateRequestDto">
    UPDATE BOARD_TBL
    <set>
      <if test="boardName != null">board_name = #{boardName},</if>
      <if test="boardDescription != null">board_description = #{boardDescription},</if>
      <if test="boardSlug != null">board_slug = #{boardSlug},</if>
      update_date = now()
    </set>
    WHERE board_idx = (<include refid="boardIdxByboardSlug"></include>) AND is_delete = 0
  </update>

  <update id="softDeleteBoardByIdx" parameterType="Integer">
    UPDATE BOARD_TBL
    SET is_delete = 1
    WHERE board_idx = #{boardIdx}
  </update>

  <update id="softDeleteBoardBySlug" parameterType="String">
    UPDATE BOARD_TBL
    SET is_delete = 1
    WHERE board_idx = (<include refid="boardIdxByboardSlug"></include>)
  </update>
</mapper>