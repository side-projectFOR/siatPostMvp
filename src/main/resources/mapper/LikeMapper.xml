<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.siat.post.domain.post.LikeMapper">

    <select id="existsLike" parameterType="com.siat.post.domain.post.dto.LikeRequestDto" resultType="boolean">
        SELECT EXISTS (
            SELECT 1 FROM LIKE_TBL
            WHERE post_idx = #{postIdx} AND user_idx = #{userIdx}
        )
    </select>

    <insert id="insertLike" parameterType="com.siat.post.domain.post.dto.LikeRequestDto">
        INSERT INTO LIKE_TBL (post_idx, user_idx, reg_date)
        VALUES (#{postIdx}, #{userIdx}, now())
    </insert>

    <delete id="deleteLike" parameterType="com.siat.post.domain.post.dto.LikeRequestDto">
        DELETE FROM LIKE_TBL WHERE post_idx = #{postIdx} AND user_idx = #{userIdx}
    </delete>
    
    <select id="countLikeByPostIdx" parameterType="long" resultType="int">
        SELECT COUNT(*) FROM LIKE_TBL WHERE post_idx = #{postIdx}
    </select>

    <select id="countAllLikeByPostIdx" parameterType="long" resultType="int">
        SELECT COUNT(*) FROM LIKE_TBL WHERE post_idx = #{postIdx}
    </select>

    <select id="selectLikeByPostIdx" parameterType="long" resultType="com.siat.post.domain.post.dto.LikeInfoDto">
        SELECT like_idx, post_idx, user_idx, reg_date
        FROM LIKE_TBL
        WHERE post_idx = #{postIdx}
    </select>
    <select id="selectAllLikeByPost" resultType="com.siat.post.domain.post.dto.LikeInfoDto">
        SELECT like_idx, post_idx, user_idx, reg_date
        FROM LIKE_TBL
        <where>
            <foreach item="postIdxList"  index="index" collection="list"
                open="post_idx in (" separator="," close=")" nullable="true">
                #{postIdxList}
            </foreach>
        </where>
    </select>
</mapper>